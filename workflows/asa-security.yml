
name: ASA Security Scan

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  asa-scan:
    runs-on: windows-latest
    steps:
      # Checkout your code
      - uses: actions/checkout@v4

      # Install .NET (needed for ASA CLI)
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      # Install ASA CLI
      - name: Install ASA
        run: dotnet tool install -g Microsoft.CST.AttackSurfaceAnalyzer.CLI

      # Baseline snapshot
      - name: Baseline collect
        run: asa collect -f -s -r -w -p --selected-directories "C:\Users\SESA705115\Desktop\AssetExtraction_FRCNN_TEXT"

      # Run your Python app setup
      - name: Install Python dependencies
        run: python -m pip install -r requirements.txt

      # Product snapshot
      - name: Product collect
        run: asa collect -f -s -r -w -p --directories "C:\Users\SESA705115\Desktop\AssetExtraction_FRCNN_TEXT"

      # Compare & Export SARIF
      - name: Export SARIF
        run: asa export-collect --outputsarif

      # Upload SARIF to GitHub Security Dashboard
      - name: Upload SARIF to GitHub Security
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: attack_surface_analyzer.sarif # Replace with actual SARIF filename
